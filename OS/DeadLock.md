# DeadLock

> 프로세스가 자원을 얻지 못해 다음 처리를 하지 못하는 상태



### 1. 개요

**운영체제 혹은 소프트웨어의 잘못된 자원 관리로 인하여 둘 이상의 프로세스가 함께 퍼지는 현상**



### 2. DeadLock 발생 조건

1. 상호 배제
   - Mutual exclusion
   - 프로그램이 자원을 점유하는 데 있어서 배타적, 즉 자원 자체를 동시에 쓸 수 없는 경우
   - 상호 배제가 없다면 발생하지 않음(자원을 여럿이 동시에 써도 되는 경우)
     - 하지만 프린터 등의 일부 I/O 장치나 연산 결과를 저장하는 변수와 같이 동시에 건드리면 위험한 자원들이 있어, 상호 배제 자체를 없애는 것은 불가능
2. 점유 상태로 대기
   - Hold and Wait
   - 자원을 붙잡은 상태에서 다른 자원을 기다리고 있는 상태
   - 여러 개의 자원을 동시에 써야 하는데 이걸 순차적으로 할당 받을 경우 몇 개는 이미 할당이 끝났는데 남은 자원을 다른 프로세스가 붙잡고 놔주지 않아 그걸 기다리는 프로세스도 함께 대기  상태에 빠지는 것
   - 여러 자원을 동시에 호출 받게 만들거나 기다려야 하는 자원을 할당 받으려면 다른 자원을 반환하도록 만드는 것으로 문제 해결 
3. 선점 불가
   - No preemption
   - 다른 프로세스가 자원을 뺏을 방법이 없다.
   - 자원을 한번 점유하면 빼앗아올 방법이 없기 때문에 사고가 난 경우 조치 방법이 없음
   - 프린터와 같이 중간에 빼앗을 경우 큰일이 나는 자원도 있기 때문에 함부로 제거할 수 없음
4. 순환성 대기
   - Circular Wait
   - 대기가 꼬리를 물고 사이클이 되었다. 
   - 대기 체인을 해결하여도 결국 자기 자신으로 되돌아오게 되어 해결이 되지 않는 상황
   - 자원에 우선 순위를 매기는 등의 방식으로 해결이 가능



### 3. 교착 상태를 벗어나는 방법

1. 예방(Prevention)

   - 교착이 일어날 상황 자체를 미연에 방지하는 것
   - 특정 프로세스 A가 자원을 계속해서 점유해야 하는 상황 에서, 만일 종료 시점을 예측할 수 없을 경우 뒤에서 대기하는 B에게 A가 점유한 자원을 건네주고 새롭게 자원을 요청하는 방식
   - 이외에 '상호 배제의 부정', '점유 및 대기 부정', '비선점 부정', '순환 대기 부정' 등의 여러 방법이 존재

2. 회피(Avoidance)

   - **은행원 알고리즘**

     - 데드락에 빠질 가능성을 운영체제가 판단한 후, 데드락에 빠질 가능성이 없다고 판단되면 할당해 주는 방식
     - Safe Sequence라는 일종의 '순서'가 존재
     -  교착 상태가 발생할 가능성이 없는 요구(안전 상태/Safe State)에는 자원 자원을 할당
     -  교착 상태가 발생할 가능성이 조금이라도 있는 요구(불안전 상태/Unsafe State)에는 추후에 해당 조건을 수행해도 문제가 없을 때 자원을 할당하는 방식
     - 장점 : 시스템이 항상 안정 상태를 유지할 수 있음
     - 단점 
       - 최대 자원의 요구량을 미리 알아야함
       - 자원의 이용도가 낮음
       - 유한한 시간 내로 자원을 사용 후 반납해야 함

   - Wait-Die 기법

     - 프로세스 A가 보유한 자원을 프로세스 B가 요청할 때 프로세스 B가 프로세스 A보다 적은 타임 스탬프를 가지는 경우에만 자원 점유를 위한 대기가 허용(그렇지 않은 경우 B는 롤백)

   - Wound-Wait 기법

     - 프로세스 A가 보유한 자원을 프로세스 B가 요청할 때 프로세스 B가 프로세스 A보다 큰 타임 스탬프를 가지는 경우에만 자원 점유를 위한 대기가 허용(그렇지 않은 경우 B는 롤백)

     >  참고) 타임 스탬프
     >
     > 프로세스가 시작되고 종료될 시간
     >
     > 참고) 상기 두 개의 방법은 둘 다 불필요한 롤백이 발생한다는 단점

3. 탐지(Detection)

   - 그래프를 그림으로써 교착 상태가 발생할 수 있는 가능성을 탐지하는 '자원 할당 그래프 알고리즘'(Resource-Allocation Graph Algorithm)
   -  자원 할당 그래프 알고리즘을 살짝 변형 시킨 'Wait for Graph'

4. 복구(Recovery)

   - 교착 상태인 프로세스를 종료시키는 방법
   - 피해가 가장 적게 발생하는 프로세스를 선택해 종료





### 참조

https://namu.wiki/w/%EB%8D%B0%EB%93%9C%EB%9D%BD

https://chanhuiseok.github.io/posts/cs-2/